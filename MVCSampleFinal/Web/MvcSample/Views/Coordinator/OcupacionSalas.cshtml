@{
    ViewData["Title"] = "Ocupación de Salas";
    Layout = "~/Views/Shared/_CoordinatorLayout.cshtml";
    var tipo = ViewBag.Tipo as string ?? "diario";
    var fecha = ViewBag.Fecha as DateTime? ?? DateTime.Now;
    var reporteSalas = ViewBag.ReporteSalas as List<dynamic> ?? new List<dynamic>();
}

<style>
    .filters-section {
        background: #f8f9fa;
        padding: 20px;
        border-radius: 8px;
        margin-bottom: 25px;
        display: flex;
        gap: 15px;
        align-items: center;
        flex-wrap: wrap;
    }

    .filter-group {
        display: flex;
        gap: 10px;
        align-items: center;
    }

    .filter-group label {
        font-weight: 600;
        color: #2c3e50;
        margin-right: 5px;
    }

    .filter-group select,
    .filter-group input {
        padding: 8px 12px;
        border: 2px solid #ddd;
        border-radius: 6px;
        font-size: 14px;
    }

    .btn-filter {
        padding: 8px 20px;
        background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
        color: white;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 500;
    }

    .btn-filter:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(52, 152, 219, 0.3);
    }

    .sala-card {
        background: white;
        border: 1px solid #e0e0e0;
        border-radius: 8px;
        padding: 20px;
        margin-bottom: 25px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .sala-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        padding-bottom: 15px;
        border-bottom: 2px solid #e0e0e0;
    }

    .sala-title {
        font-size: 20px;
        font-weight: 600;
        color: #2c3e50;
    }

    .sala-info {
        font-size: 14px;
        color: #666;
    }

    .horas-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
        gap: 10px;
        margin-top: 15px;
    }

    .hora-item {
        padding: 10px;
        border-radius: 6px;
        text-align: center;
        font-size: 12px;
        font-weight: 500;
    }

    .hora-libre {
        background-color: #d4edda;
        color: #155724;
    }

    .hora-ocupada-sala {
        background-color: #fff3cd;
        color: #856404;
    }

    .hora-ocupada-equipos {
        background-color: #cfe2ff;
        color: #084298;
    }

    .dias-grid {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 15px;
        margin-top: 15px;
    }

    .dia-item {
        padding: 15px;
        border-radius: 8px;
        text-align: center;
        border: 2px solid #e0e0e0;
    }

    .dia-nombre {
        font-weight: 600;
        color: #2c3e50;
        margin-bottom: 10px;
    }

    .dia-fecha {
        font-size: 12px;
        color: #666;
        margin-bottom: 10px;
    }

    .dia-reservas {
        font-size: 14px;
        color: #666;
    }

    .dia-reservas strong {
        color: #2c3e50;
    }

    .stats-summary {
        display: flex;
        gap: 20px;
        margin-top: 15px;
        padding-top: 15px;
        border-top: 1px solid #e0e0e0;
    }

    .stat-item {
        flex: 1;
        text-align: center;
        padding: 10px;
        background: #f8f9fa;
        border-radius: 6px;
    }

    .stat-label {
        font-size: 12px;
        color: #666;
        margin-bottom: 5px;
    }

    .stat-value {
        font-size: 20px;
        font-weight: 600;
        color: #2c3e50;
    }

    .reservas-list {
        margin-top: 20px;
        padding-top: 20px;
        border-top: 1px solid #e0e0e0;
    }

    .reservas-list h4 {
        font-size: 16px;
        font-weight: 600;
        color: #2c3e50;
        margin-bottom: 10px;
    }

    .reserva-item {
        padding: 10px;
        background: #f8f9fa;
        border-radius: 6px;
        margin-bottom: 8px;
        font-size: 14px;
    }

    .reserva-item strong {
        color: #2c3e50;
    }
</style>

<div class="filters-section">
    <div class="filter-group">
        <label>Tipo de Reporte:</label>
        <select id="tipoReporte" onchange="cambiarTipo()">
            @if (tipo == "diario")
            {
                <option value="diario" selected>Diario</option>
            }
            else
            {
                <option value="diario">Diario</option>
            }
            @if (tipo == "semanal")
            {
                <option value="semanal" selected>Semanal</option>
            }
            else
            {
                <option value="semanal">Semanal</option>
            }
        </select>
    </div>
    <div class="filter-group">
        <label>Fecha:</label>
        <input type="date" id="fechaConsulta" value="@fecha.ToString("yyyy-MM-dd")" />
    </div>
    <button class="btn-filter" onclick="aplicarFiltros()">Aplicar Filtros</button>
</div>

@if (reporteSalas.Any())
{
    @foreach (var reporte in reporteSalas)
    {
        <div class="sala-card">
            <div class="sala-header">
                <div>
                    <div class="sala-title">Sala @reporte.Sala.Numero</div>
                    <div class="sala-info">@reporte.Sala.Ubicacion | Capacidad: @reporte.Sala.Capacidad personas</div>
                </div>
            </div>

            @if (tipo == "diario")
            {
                <div>
                    <h4 style="margin-bottom: 15px; color: #2c3e50;">Ocupación por Horas - @fecha.ToString("dd/MM/yyyy")</h4>
                    <div class="horas-grid">
                        @foreach (var hora in reporte.HorasOcupadas)
                        {
                            var claseHora = hora.Ocupada 
                                ? (hora.Tipo == "Sala" ? "hora-ocupada-sala" : "hora-ocupada-equipos")
                                : "hora-libre";
                            <div class="hora-item @claseHora">
                                <div>@hora.HoraTexto</div>
                                <div style="font-size: 10px; margin-top: 5px;">@hora.Tipo</div>
                            </div>
                        }
                    </div>

                    <div class="stats-summary">
                        <div class="stat-item">
                            <div class="stat-label">Total Horas Ocupadas</div>
                            <div class="stat-value">@reporte.TotalHorasOcupadas / 24</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">Reservas de Sala</div>
                            <div class="stat-value">@reporte.ReservasSala.Count</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">Reservas de Equipos</div>
                            <div class="stat-value">@reporte.ReservasEquipos.Count</div>
                        </div>
                    </div>

                    @if (reporte.ReservasSala.Any() || reporte.ReservasEquipos.Any())
                    {
                        <div class="reservas-list">
                            @if (reporte.ReservasSala.Any())
                            {
                                <h4>Reservas de Sala:</h4>
                                @foreach (var reserva in reporte.ReservasSala)
                                {
                                    <div class="reserva-item">
                                        <strong>@reserva.Solicitante</strong> - 
                                        @reserva.FechaHoraInicio?.ToString("dd/MM/yyyy HH:mm") - 
                                        @reserva.FechaHoraFin?.ToString("HH:mm") | 
                                        Estado: @reserva.Estado
                                    </div>
                                }
                            }

                            @if (reporte.ReservasEquipos.Any())
                            {
                                <h4 style="margin-top: 15px;">Reservas de Equipos:</h4>
                                @foreach (var reserva in reporte.ReservasEquipos)
                                {
                                    <div class="reserva-item">
                                        <strong>@reserva.Solicitante</strong> - 
                                        Equipo: @reserva.Equipo.Nombre - 
                                        @reserva.FechaHoraInicio?.ToString("dd/MM/yyyy HH:mm") - 
                                        @reserva.FechaHoraFin?.ToString("HH:mm") | 
                                        Estado: @reserva.Estado
                                    </div>
                                }
                            }
                        </div>
                    }
                </div>
            }
            else
            {
                <div>
                    <h4 style="margin-bottom: 15px; color: #2c3e50;">
                        Ocupación Semanal - @reporte.InicioSemana.ToString("dd/MM/yyyy") al @reporte.FinSemana.AddDays(-1).ToString("dd/MM/yyyy")
                    </h4>
                    <div class="dias-grid">
                        @foreach (var dia in reporte.DiasSemana)
                        {
                            <div class="dia-item">
                                <div class="dia-nombre">@dia.DiaNombre</div>
                                <div class="dia-fecha">@dia.Fecha.ToString("dd/MM/yyyy")</div>
                                <div class="dia-reservas">
                                    <strong>@dia.TotalReservas</strong> reservas<br/>
                                    <small>Sala: @dia.ReservasSala | Equipos: @dia.ReservasEquipos</small>
                                </div>
                            </div>
                        }
                    </div>

                    <div class="stats-summary">
                        <div class="stat-item">
                            <div class="stat-label">Total Reservas de Sala</div>
                            <div class="stat-value">@reporte.TotalReservasSala</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">Total Reservas de Equipos</div>
                            <div class="stat-value">@reporte.TotalReservasEquipos</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">Total Reservas</div>
                            <div class="stat-value">@(reporte.TotalReservasSala + reporte.TotalReservasEquipos)</div>
                        </div>
                    </div>
                </div>
            }
        </div>
    }
}
else
{
    <div style="text-align: center; padding: 40px; color: #999;">
        No hay salas disponibles para mostrar el reporte
    </div>
}

@section Scripts {
    <script>
        function cambiarTipo() {
            var tipo = document.getElementById('tipoReporte').value;
            var fecha = document.getElementById('fechaConsulta').value;
            window.location.href = '@Url.Action("OcupacionSalas", "Coordinator")?tipo=' + tipo + '&fecha=' + fecha;
        }

        function aplicarFiltros() {
            var tipo = document.getElementById('tipoReporte').value;
            var fecha = document.getElementById('fechaConsulta').value;
            window.location.href = '@Url.Action("OcupacionSalas", "Coordinator")?tipo=' + tipo + '&fecha=' + fecha;
        }
    </script>
}

